MANAGER

Отключиться от облака, если ранее были подключены
$ docker swarm leave --force

Создать docker_gwbridge
$ ./create-gwbridge

Инициировать swarm
$ docker swarm init --advertise-addr 10.33.32.32

Удалить ненужную нам сеть ingress
$ docker network rm ingress

Создать оверлейную сеть
$ ./create-overlay


Проверитиь наличие созданных объектов:

$ docker node ls
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
eq5uad0m7xyp67hhi7340iw8i *   southport           Ready               Active              Leader              19.03.4

$ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
38rm36nd0l9w        bogatka-net         overlay             swarm
2f9665844425        bridge              bridge              local
226c4f50e0dd        docker_gwbridge     bridge              local
631c369d820e        host                host                local
37a67bb6c596        none                null                local

$ ip ad sh dev docker_gwbridge
65: docker_gwbridge: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default
    link/ether 02:42:dc:e2:ab:93 brd ff:ff:ff:ff:ff:ff
    inet 172.31.2.1/24 brd 172.31.2.255 scope global docker_gwbridge
       valid_lft forever preferred_lft forever
    inet6 fe80::42:dcff:fee2:ab93/64 scope link
       valid_lft forever preferred_lft forever



Запустить БД для Богатки

$ sudo mkdir -p /var/lib/postgresql/docker/bogatka
$ sudo chown 1001:1001 /var/lib/postgresql/docker/bogatka
$ ./run-bogatka-db

Проверить что контейнер запустился:

$ docker ps
CONTAINER ID        IMAGE                       COMMAND                  CREATED              STATUS              PORTS               NAMES
0258f89dc10d        bitnami/postgresql:latest   "/entrypoint.sh /run…"   About a minute ago   Up About a minute   5432/tcp            bogatka-db
